# üöÄ BearsMoney - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é

## üéØ –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û:**

1. **‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã** (`app/handlers/daily_rewards.py`)
   - –°–∏—Å—Ç–µ–º–∞ —Å—Ç—Ä–∏–∫–æ–≤ (1-30 –¥–Ω–µ–π)
   - –£–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–µ—Å—è –Ω–∞–≥—Ä–∞–¥—ã
   - –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã (—Ä–∞–∑ –≤ –¥–µ–Ω—å)
   - –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞–≥—Ä–∞–¥

2. **‚úÖ Premium –ø–æ–¥–ø–∏—Å–∫–∞** (`app/handlers/premium.py`)
   - 3 —Ç–∞—Ä–∏—Ñ–∞: Basic, Premium, VIP
   - –ë–æ–Ω—É—Å—ã: +50%/+100% –¥–æ—Ö–æ–¥, 0% –∫–æ–º–∏—Å—Å–∏–∏
   - –ê–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏–µ
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –±–µ–π–¥–∂–∏

3. **‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** (–≤ models.py)
   - 3 —É—Ä–æ–≤–Ω—è: 20%, 10%, 5%
   - –¢—Ä–µ–∫–∏–Ω–≥ –∑–∞—Ä–∞–±–æ—Ç–∫–∞
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

4. **‚úÖ –ö–æ–º–∏—Å—Å–∏—è –Ω–∞ –æ–±–º–µ–Ω** (`app/handlers/exchange.py`)
   - 2% –∫–æ–º–∏—Å—Å–∏—è –Ω–∞ Coins ‚Üî TON
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

### üöß **–¢–†–ï–ë–£–ï–¢ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò:**

5. **üöß NFT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (`app/handlers/nft.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –º–µ–¥–≤–µ–¥–µ–π –≤ NFT (TON)
   - P2P marketplace
   - Royalty 5%

6. **üöß –í–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–∞—è —Ä–µ–∫–ª–∞–º–∞** (`app/handlers/ads.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤–∏–¥–µ–æ –∑–∞ 100 Coins
   - Telegram Ads –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
   - –õ–∏–º–∏—Ç 10/–¥–µ–Ω—å

7. **üöß –£–ª—É—á—à–µ–Ω–∏—è –º–µ–¥–≤–µ–¥–µ–π** (`app/handlers/bear_upgrades.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
   - –ê–ø–≥—Ä–µ–π–¥—ã +10% –∑–∞ 1000 Coins
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ (2x coins)
   - –≠–≤–æ–ª—é—Ü–∏—è (5 —Å—Ç–∞–¥–∏–π)
   - –°–ª–∏—è–Ω–∏–µ (10 common = 1 rare)

8. **üöß PvP –±–∞—Ç–ª—ã** (`app/handlers/pvp.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
   - –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è –º–µ–¥–≤–µ–¥–µ–π
   - –°—Ç–∞–≤–∫–∏ –≤ Coins
   - –†–∞–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
   - –õ–∏–¥–µ—Ä–±–æ—Ä–¥

9. **üöß –ê–Ω–∞–ª–∏—Ç–∏–∫–∞** (`app/services/analytics.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
   - Tracking —Å–æ–±—ã—Ç–∏–π
   - –ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
   - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

10. **üöß –ü—É—à-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (`app/services/notifications.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–±–æ—Ä–µ Coins
    - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    - Smart timing

11. **üöß Backup —Å–∏—Å—Ç–µ–º–∞** (`scripts/backup.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
    - –ê–≤—Ç–æ–±—ç–∫–∞–ø—ã –∫–∞–∂–¥—ã–µ 6—á
    - Restore —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

12. **üöß Onboarding** (`app/handlers/tutorial.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
    - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—É—Ç–æ—Ä–∏–∞–ª
    - –ù–∞–≥—Ä–∞–¥—ã –∑–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ

13. **üöß –ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞** (`app/handlers/partnerships.py` - –Ω–µ —Å–æ–∑–¥–∞–Ω)
    - –ö—Ä–æ—Å—Å-–ø—Ä–æ–º–æ
    - –°–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ –∫–µ–π—Å—ã

---

## üõ†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1Ô∏è‚É£ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers –≤ bot.py**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–æ–≤—ã–µ handlers –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**

```python
# app/bot.py

def setup_handlers():
    from app.handlers import (
        start, bears, shop, profile, admin, 
        cases, exchange, payment,
        daily_rewards,  # ‚úÖ –ù–û–í–û–ï
        premium,        # ‚úÖ –ù–û–í–û–ï
    )
    
    dp.include_router(start.router)
    dp.include_router(bears.router)
    dp.include_router(shop.router)
    dp.include_router(profile.router)
    dp.include_router(exchange.router)
    dp.include_router(payment.router)
    dp.include_router(daily_rewards.router)  # ‚úÖ –ù–û–í–û–ï
    dp.include_router(premium.router)        # ‚úÖ –ù–û–í–û–ï
    dp.include_router(admin.router)
    dp.include_router(cases.router)
```

---

### 2Ô∏è‚É£ **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –≤ start.py**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ `/start ref_12345`

**–†–µ—à–µ–Ω–∏–µ:**

```python
# app/handlers/start.py

from aiogram.filters import CommandStart, CommandObject

@router.message(CommandStart(deep_link=True))
async def start_with_referral(message: Message, command: CommandObject):
    """
    Handle /start with referral code.
    """
    referral_code = command.args  # ref_12345
    
    if referral_code and referral_code.startswith('ref_'):
        referrer_id = int(referral_code.split('_')[1])
        
        # Check if referrer exists
        referrer = await session.execute(
            select(User).where(User.telegram_id == referrer_id)
        )
        referrer = referrer.scalar_one_or_none()
        
        if referrer and user.referred_by is None:
            user.referred_by = referrer.telegram_id
            referrer.referred_count += 1
            
            # Give bonus
            user.coins += 500
            referrer.coins += 500
            
            await session.commit()
```

---

### 3Ô∏è‚É£ **–ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –≤ models.py, –Ω–æ —Ç–∞–±–ª–∏—Ü –Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /path/to/bearsmoney

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Alembic (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)
pip install alembic
alembic init migrations

# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Add daily_rewards and premium models"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å
alembic upgrade head
```

**–ò–õ–ò –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± (–¥–ª—è SQLite):**

```python
# –í Python –∫–æ–Ω—Å–æ–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
import asyncio
from app.database.models import Base
from app.database.db import engine

async def create_tables():
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)

asyncio.run(create_tables())
```

---

### 4Ô∏è‚É£ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ exchange.py**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ —Å–±–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

```python
# app/handlers/exchange.py

try:
    async with get_session() as session:
        # ... –≤—Å—è –ª–æ–≥–∏–∫–∞ –æ–±–º–µ–Ω–∞
        
        user.coins -= amount
        user.ton_balance += ton_amount
        
        await session.commit()
        
except Exception as e:
    await session.rollback()  # ‚úÖ –û–¢–ö–ê–¢ –ò–ó–ú–ï–ù–ï–ù–ò–ô
    logger.error(f"‚ùå Exchange error: {e}", exc_info=True)
    await query.answer("‚ùå –û—à–∏–±–∫–∞ –æ–±–º–µ–Ω–∞", show_alert=True)
```

---

### 5Ô∏è‚É£ **Rate Limiting**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**

```python
# app/middlewares/rate_limit.py (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

from aiogram import BaseMiddleware
from typing import Callable, Awaitable, Dict, Any
from aiogram.types import Message, CallbackQuery
from datetime import datetime, timedelta

class RateLimitMiddleware(BaseMiddleware):
    def __init__(self, rate_limit: int = 3):
        self.rate_limit = rate_limit
        self.user_requests = {}
    
    async def __call__(
        self,
        handler: Callable[[Message | CallbackQuery, Dict[str, Any]], Awaitable[Any]],
        event: Message | CallbackQuery,
        data: Dict[str, Any]
    ) -> Any:
        user_id = event.from_user.id
        now = datetime.now()
        
        # Check rate limit
        if user_id in self.user_requests:
            last_request, count = self.user_requests[user_id]
            if now - last_request < timedelta(seconds=1):
                if count >= self.rate_limit:
                    return  # –ë–ª–æ–∫–∏—Ä—É–µ–º
                self.user_requests[user_id] = (last_request, count + 1)
            else:
                self.user_requests[user_id] = (now, 1)
        else:
            self.user_requests[user_id] = (now, 1)
        
        return await handler(event, data)

# –í bot.py
from app.middlewares.rate_limit import RateLimitMiddleware

dp.message.middleware(RateLimitMiddleware(rate_limit=3))
dp.callback_query.middleware(RateLimitMiddleware(rate_limit=5))
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
cd /path/to/bearsmoney
git pull origin main

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ)
pip install -r requirements.txt

# 3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
python3 -c "import asyncio; from app.database.models import Base; from app.database.db import engine; asyncio.run(engine.begin().run_sync(Base.metadata.create_all))"

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
sudo systemctl restart bearsmoney

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo journalctl -u bearsmoney -f
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã:
1. –û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞
2. –ù–∞–∂–∞—Ç—å "üéâ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã"
3. –ó–∞–±—Ä–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É
4. –ö—Ä—É—Ç–∏—Ç—å –∫–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã

### Premium:
1. –ù–∞–∂–∞—Ç—å "‚≠ê Premium"
2. –í—ã–±—Ä–∞—Ç—å Premium –∏–ª–∏ VIP
3. –û–ø–ª–∞—Ç–∏—Ç—å Coins –∏–ª–∏ TON
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–æ–Ω—É—Å—ã –≤ –ø—Ä–æ—Ñ–∏–ª–µ

---

## üîß –¢—Ä—É–±–ª—à—É—Ç–∏–Ω–≥

### –ü—Ä–æ–±–ª–µ–º–∞: "–ö–Ω–æ–ø–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç"

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo journalctl -u bearsmoney | grep "ERROR"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é handlers
python3 -c "from app.bot import dp; print([r.name for r in dp.sub_routers])"
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ë–î –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è"

```bash
# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –ë–î (–û–°–¢–û–†–û–ñ–ù–û!)
rm bearsmoney.db

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é
python3 -c "import asyncio; from app.database.models import Base; from app.database.db import engine; asyncio.run(engine.begin().run_sync(Base.metadata.create_all))"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl restart bearsmoney
```

---

## üìù TODO List

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (—Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–º):
- [x] –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã
- [x] Premium –ø–æ–¥–ø–∏—Å–∫–∞
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers –≤ bot.py
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –≤ start.py
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

### –í–∞–∂–Ω—ã–µ:
- [ ] NFT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –£–ª—É—á—à–µ–Ω–∏—è –º–µ–¥–≤–µ–¥–µ–π
- [ ] PvP –±–∞—Ç–ª—ã
- [ ] –†–µ–∫–ª–∞–º–∞

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ:
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- [ ] –ü—É—à-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] Backup —Å–∏—Å—Ç–µ–º–∞
- [ ] Onboarding
- [ ] –ü–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞

---

## üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u bearsmoney -f`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î: `sqlite3 bearsmoney.db ".tables"`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `sudo systemctl restart bearsmoney`

üéâ **–£–¥–∞—á–∏ —Å –∑–∞–ø—É—Å–∫–æ–º!**
